<!doctype html><html lang=en>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Python Standard Library changes in recent years</title>
<meta name=description content="17 modules with new and improved features.">
<meta name=robots content="index, follow">
<link rel=stylesheet type=text/css href=/assets/css/style.fe03afa13d4e1d4607de8f21a6d227f1314ba69e0bf3e4c1e4ce111080af6bb8.css>
<link rel=icon href=/assets/favicon/favicon.ico sizes=any>
<link rel=icon type=image/svg+xml href=/assets/favicon/favicon.svg>
<link rel=apple-touch-icon href=/assets/favicon/apple-touch-icon.png>
<link rel=manifest href=/assets/favicon/manifest.json>
<link rel=canonical href=https://antonz.org/python-stdlib-changes/>
<meta name=author content="Anton Zhiyanov">
<meta property="og:type" content="article">
<meta property="og:title" content="Python Standard Library changes in recent years">
<meta property="og:description" content="17 modules with new and improved features.">
<meta property="og:url" content="https://antonz.org/python-stdlib-changes/">
<meta property="og:image" content="https://antonz.org/python-stdlib-changes/cover.png">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:title content="Python Standard Library changes in recent years">
<meta name=twitter:description content="17 modules with new and improved features.">
<meta name=twitter:url content="https://antonz.org/python-stdlib-changes/">
<meta name=twitter:site content="@ohmypy">
<meta name=twitter:image content="https://antonz.org/python-stdlib-changes/cover.png"></head>
<body>
<div class=header>
<div class=container>
<div class=row>
<div class="col-xs-6 col-sm-3">
<a class=img-link href=/>
<img src=/assets/logo.svg class=header-icon>
</a> 
<a href=/>
<strong>Anton Zhiyanov</strong>
</a>
</div>
<div class="col-xs-12 col-sm-6 col-md-4 hidden-mobile">
<a class=menu__link href=/all/>
<span>blog</span>
</a>
<a class=menu__link href=/#about>
<span>contacts</span>
</a>
<a class=menu__link href=https://antonz.ru>
<span>ru</span>
</a>
</div>
</div>
</div>
</div>
<div class=storey>
<div class=container>
<article class=post>
<div class=row>
<div class="col-xs-12 col-sm-10 article">
<header>
<h1>Python Standard Library changes in recent years</h1>
</header>
<p>With each major Python release, all the attention goes to the new language features: the walrus operator, dictionary merging, pattern matching. There is also a lot of writing about <code>asyncio</code> and <code>typing</code> modules — they are developing rapidly and are obviously important for the core team.</p>
<p>The rest of the standard library modules receive undeservedly little attention. I want to fix this and tell you about the novelties introduced in versions 3.8–3.10.</p>
<blockquote>
<p><strong>Note</strong>. This is not an exhaustive list, of course. I write only about those changes that interested me personally. But since I am not too much different from the &ldquo;average&rdquo; Python backend developer, it is likely that you will also be interested. Let me know if I missed something.</p>
</blockquote>
<p>The modules are in alphabetical order, so if you get bored with the first (little-known) ones, do not be discouraged — it gets more exciting further.</p>
<p><a href=#array>array</a> • <a href=#base64>base64</a> • <a href=#bisect>bisect</a> • <a href=#builtins>builtins</a> • <a href=#dataclasses>dataclasses</a> • <a href=#datetime>datetime</a> • <a href=#fractions>fractions</a> • <a href=#functools>functools</a> • <a href=#glob>glob</a> • <a href=#graphlib>graphlib</a> • <a href=#itertools>itertools</a> • <a href=#math>math</a> • <a href=#random>random</a> • <a href=#shlex>shlex</a> • <a href=#shutil>shutil</a> • <a href=#statistics>statistics</a> • <a href=#zoneinfo>zoneinfo</a></p>
<p>All new features and improvements in the article are accompanied by examples. You can try them in the playground or run locally. If you have an older local Python, run it using Docker:</p>
<pre tabindex=0><code>$ docker run -it --rm python:3.10-alpine
</code></pre><h2 id=array>array</h2>
<p><a href=https://docs.python.org/3/library/array><code>array</code></a> module provides compact typed numeric arrays. It is used much less frequently than the famous <code>list</code> counterpart.</p>
<p><a href=https://docs.python.org/3/library/array#array.array.index><code>array.index()</code></a> methods finds the value in the array and returns the index of the found element. Now it supports optional <code>start</code> and <code>stop</code> parameters, which define the search interval (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>from</span> <span style=color:#000>array</span> <span style=color:#a90d91>import</span> <span style=color:#000>array</span>
<span style=color:#000>arr</span> <span style=color:#000>=</span> <span style=color:#000>array</span>(<span style=color:#c41a16>&#34;i&#34;</span>, [<span style=color:#1c01ce>7</span>, <span style=color:#1c01ce>11</span>, <span style=color:#1c01ce>19</span>, <span style=color:#1c01ce>42</span>])

<span style=color:#000>idx</span> <span style=color:#000>=</span> <span style=color:#000>arr</span><span style=color:#000>.</span><span style=color:#000>index</span>(<span style=color:#1c01ce>11</span>)
<span style=color:#177500># idx == 1</span>

<span style=color:#000>idx</span> <span style=color:#000>=</span> <span style=color:#000>arr</span><span style=color:#000>.</span><span style=color:#000>index</span>(<span style=color:#1c01ce>11</span>, <span style=color:#1c01ce>2</span>)
<span style=color:#177500># ValueError: array.index(x): x not in array</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717024/step/2>playground</a></p>
<p>Contributed by: <a href=https://github.com/Phaqui>Anders Lorentsen</a> • <a href=https://github.com/ZackerySpytz>Zackery Spytz</a></p>
<h2 id=base64>base64</h2>
<p><a href=https://docs.python.org/3/library/base64><code>base64</code></a> module encodes binary data into ASCII strings using Base16, Base32, and Base64 algorithms.</p>
<p>It received a couple of new functions: <a href=https://docs.python.org/3/library/base64#base64.b32hexencode><code>b32hexencode()</code></a> and <a href=https://docs.python.org/3/library/base64#base64.b32hexdecode><code>b32hexdecode()</code></a>, which use an extended 32-character alphabet according to <a href=https://datatracker.ietf.org/doc/html/rfc4648.html#section-7>RFC 4648</a> (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>base64</span>
<span style=color:#a90d91>bytes</span> <span style=color:#000>=</span> <span style=color:#c41a16>b</span><span style=color:#c41a16>&#34;python is awesome&#34;</span>

<span style=color:#000>base64</span><span style=color:#000>.</span><span style=color:#000>b32encode</span>(<span style=color:#a90d91>bytes</span>)
<span style=color:#177500># b&#39;OB4XI2DPNYQGS4ZAMF3WK43PNVSQ====&#39;</span>

<span style=color:#000>base64</span><span style=color:#000>.</span><span style=color:#000>b32hexencode</span>(<span style=color:#a90d91>bytes</span>)
<span style=color:#177500># b&#39;E1SN8Q3FDOG6ISP0C5RMASRFDLIG====&#39;</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717024/step/3>playground</a></p>
<p>Contributed by: <a href=https://github.com/FFY00>Filipe Laíns</a></p>
<h2 id=bisect>bisect</h2>
<p><a href=https://docs.python.org/3/library/bisect><code>bisect</code></a> module works with sorted lists using binary search method. Main functions are:</p>
<ul>
<li><a href=https://docs.python.org/3/library/bisect#bisect.bisect><code>bisect()</code></a> finds an item in the list;</li>
<li><a href=https://docs.python.org/3/library/bisect#bisect.insort><code>insort()</code></a> adds an item while retaining the order.</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>bisect</span>

<span style=color:#000>lst</span> <span style=color:#000>=</span> [<span style=color:#1c01ce>7</span>, <span style=color:#1c01ce>11</span>, <span style=color:#1c01ce>19</span>, <span style=color:#1c01ce>42</span>]
<span style=color:#000>idx</span> <span style=color:#000>=</span> <span style=color:#000>bisect</span><span style=color:#000>.</span><span style=color:#000>bisect</span>(<span style=color:#000>lst</span>, <span style=color:#1c01ce>12</span>)
<span style=color:#177500># idx == 2</span>

<span style=color:#000>bisect</span><span style=color:#000>.</span><span style=color:#000>insort</span>(<span style=color:#000>lst</span>, <span style=color:#1c01ce>12</span>)
<span style=color:#177500># [7, 11, 12, 19, 42]</span>
</code></pre></div><p>Since version 3.10, all module functions support the optional <code>key</code> parameter. It is a function that returns the value of a list item. It is convenient to use if the elements cannot be compared directly:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>bisect</span>
<span style=color:#a90d91>import</span> <span style=color:#000>operator</span>

<span style=color:#000>p1</span> <span style=color:#000>=</span> {<span style=color:#c41a16>&#34;id&#34;</span>: <span style=color:#1c01ce>11</span>, <span style=color:#c41a16>&#34;name&#34;</span>: <span style=color:#c41a16>&#34;Diane&#34;</span>}
<span style=color:#000>p2</span> <span style=color:#000>=</span> {<span style=color:#c41a16>&#34;id&#34;</span>: <span style=color:#1c01ce>12</span>, <span style=color:#c41a16>&#34;name&#34;</span>: <span style=color:#c41a16>&#34;Bob&#34;</span>}
<span style=color:#000>p3</span> <span style=color:#000>=</span> {<span style=color:#c41a16>&#34;id&#34;</span>: <span style=color:#1c01ce>13</span>, <span style=color:#c41a16>&#34;name&#34;</span>: <span style=color:#c41a16>&#34;Emma&#34;</span>}

<span style=color:#000>key</span> <span style=color:#000>=</span> <span style=color:#000>operator</span><span style=color:#000>.</span><span style=color:#000>itemgetter</span>(<span style=color:#c41a16>&#34;name&#34;</span>)
<span style=color:#000>people</span> <span style=color:#000>=</span> <span style=color:#a90d91>sorted</span>([<span style=color:#000>p1</span>, <span style=color:#000>p2</span>, <span style=color:#000>p3</span>], <span style=color:#000>key</span><span style=color:#000>=</span><span style=color:#000>key</span>)
<span style=color:#177500># Bob, Diane, Emma</span>

<span style=color:#000>idx</span> <span style=color:#000>=</span> <span style=color:#000>bisect</span><span style=color:#000>.</span><span style=color:#000>bisect</span>(<span style=color:#000>people</span>, <span style=color:#c41a16>&#34;Dan&#34;</span>)
<span style=color:#177500># TypeError: &#39;&lt;&#39; not supported between instances of &#39;str&#39; and &#39;dict&#39;</span>

<span style=color:#000>idx</span> <span style=color:#000>=</span> <span style=color:#000>bisect</span><span style=color:#000>.</span><span style=color:#000>bisect</span>(<span style=color:#000>people</span>, <span style=color:#c41a16>&#34;Dan&#34;</span>, <span style=color:#000>key</span><span style=color:#000>=</span><span style=color:#000>key</span>)
<span style=color:#177500># idx == 1</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717024/step/4>playground</a></p>
<p>Contributed by: <a href=https://github.com/rhettinger>Raymond Hettinger</a></p>
<h2 id=builtins>builtins</h2>
<p><a href=https://docs.python.org/3/library/builtins><code>builtins</code></a> module contains all the built-in functions and classes that programmers use without imports: <code>int</code>, <code>list</code>, <code>len()</code>, <code>open()</code> and the like.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>builtins</span>

<span style=color:#a90d91>list</span> <span style=color:#000>is</span> <span style=color:#000>builtins</span><span style=color:#000>.</span><span style=color:#000>list</span>
<span style=color:#177500># True</span>

<span style=color:#a90d91>len</span> <span style=color:#000>is</span> <span style=color:#000>builtins</span><span style=color:#000>.</span><span style=color:#000>len</span>
<span style=color:#177500># True</span>
</code></pre></div><p>The <strong>string</strong> received <a href=https://docs.python.org/3/library/stdtypes#str.removeprefix><code>str.removeprefix()</code></a> and <a href=https://docs.python.org/3/library/stdtypes#str.removesuffix><code>str.removesuffix()</code></a> methods, which cut off the string head and tail respectively (3.9+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>s</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;Python is awesome&#34;</span>

<span style=color:#000>s</span><span style=color:#000>.</span><span style=color:#000>removeprefix</span>(<span style=color:#c41a16>&#34;Python is &#34;</span>)
<span style=color:#177500># &#39;awesome&#39;</span>

<span style=color:#000>s</span><span style=color:#000>.</span><span style=color:#000>removesuffix</span>(<span style=color:#c41a16>&#34; is awesome&#34;</span>)
<span style=color:#177500># &#39;Python&#39;</span>
</code></pre></div><p>The <strong>integer</strong> received the <a href=https://docs.python.org/3/library/stdtypes#int.bit_count><code>int.bit_count()</code></a> method, which returns the number of ones in the binary representation of the integer (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>n</span> <span style=color:#000>=</span> <span style=color:#1c01ce>42</span>

<span style=color:#a90d91>bin</span>(<span style=color:#000>n</span>)
<span style=color:#177500># &#39;0b101010&#39;</span>

<span style=color:#000>n</span><span style=color:#000>.</span><span style=color:#000>bit_count</span>()
<span style=color:#177500># 3</span>
</code></pre></div><p>The <strong>dictionary</strong> methods <code>dict.key()</code>, <code>dict.values()</code> and <code>dict.items()</code> return view objects that reference dictionary data. Previously, it was impossible to get a reverse link to the dictionary from these objects, but now it can be done — through the <code>.mapping</code> attribute (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>people</span> <span style=color:#000>=</span> {
    <span style=color:#c41a16>&#34;Diane&#34;</span>: <span style=color:#1c01ce>70</span>,
    <span style=color:#c41a16>&#34;Bob&#34;</span>: <span style=color:#1c01ce>78</span>,
    <span style=color:#c41a16>&#34;Emma&#34;</span>: <span style=color:#1c01ce>84</span>
}

<span style=color:#000>keys</span> <span style=color:#000>=</span> <span style=color:#000>people</span><span style=color:#000>.</span><span style=color:#000>keys</span>()
<span style=color:#177500># dict_keys([&#39;Diane&#39;, &#39;Bob&#39;, &#39;Emma&#39;])</span>

<span style=color:#000>keys</span><span style=color:#000>.</span><span style=color:#000>mapping</span>[<span style=color:#c41a16>&#34;Bob&#34;</span>]
<span style=color:#177500># 78</span>
</code></pre></div><p><strong>Collection merging</strong> <a href=https://docs.python.org/3/library/functions#zip><code>zip()</code></a> function received the <code>strict</code> parameter. It ensures that the sequences are of the same length (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>keys</span> <span style=color:#000>=</span> [<span style=color:#c41a16>&#34;Diane&#34;</span>, <span style=color:#c41a16>&#34;Bob&#34;</span>, <span style=color:#c41a16>&#34;Emma&#34;</span>]
<span style=color:#000>vals</span> <span style=color:#000>=</span> [<span style=color:#1c01ce>70</span>, <span style=color:#1c01ce>78</span>, <span style=color:#1c01ce>84</span>, <span style=color:#1c01ce>42</span>]

<span style=color:#000>pairs</span> <span style=color:#000>=</span> <span style=color:#a90d91>zip</span>(<span style=color:#000>keys</span>, <span style=color:#000>vals</span>)
<span style=color:#a90d91>list</span>(<span style=color:#000>pairs</span>)
<span style=color:#177500># [(&#39;Diane&#39;, 70), (&#39;Bob&#39;, 78), (&#39;Emma&#39;, 84)]</span>

<span style=color:#000>pairs</span> <span style=color:#000>=</span> <span style=color:#a90d91>zip</span>(<span style=color:#000>keys</span>, <span style=color:#000>vals</span>, <span style=color:#000>strict</span><span style=color:#000>=</span><span style=color:#a90d91>True</span>)
<span style=color:#a90d91>list</span>(<span style=color:#000>pairs</span>)
<span style=color:#177500># ValueError: zip() argument 2 is longer than argument 1</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717024/step/5>playground</a></p>
<p>Contributed by: <a href=https://github.com/sweeneyde>Dennis Sweeney</a> • <a href=https://github.com/niklasf>Niklas Fiekas</a> • <a href=https://github.com/brandtbucher>Brandt Bucher</a></p>
<h2 id=dataclasses>dataclasses</h2>
<p><a href=https://docs.python.org/3/library/dataclasses><code>dataclasses</code></a> module generates classes according to the specification.</p>
<p>Dataclasses can now use <a href=https://docs.python.org/3/reference/datamodel.html#slots><code>slots</code></a>, which are great for creating <a href=/compact-objects/>compact data objects</a> with a fixed set of properties (3.10+).</p>
<p>Regular dataclass:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>from</span> <span style=color:#000>dataclasses</span> <span style=color:#a90d91>import</span> <span style=color:#000>dataclass</span>

<span style=color:#000>@dataclass</span>
<span style=color:#a90d91>class</span> <span style=color:#3f6e75>Person</span>:
    <span style=color:#a90d91>id</span>: <span style=color:#a90d91>int</span>
    <span style=color:#000>name</span>: <span style=color:#a90d91>str</span>

<span style=color:#000>diane</span> <span style=color:#000>=</span> <span style=color:#000>Person</span>(<span style=color:#a90d91>id</span><span style=color:#000>=</span><span style=color:#1c01ce>11</span>, <span style=color:#000>name</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;Diane&#34;</span>)
<span style=color:#000>diane</span><span style=color:#000>.</span><span style=color:#000>__dict__</span>
<span style=color:#177500># {&#39;id&#39;: 11, &#39;name&#39;: &#39;Diane&#39;}</span>
<span style=color:#000>diane</span><span style=color:#000>.</span><span style=color:#000>salary</span> <span style=color:#000>=</span> <span style=color:#1c01ce>70</span>
<span style=color:#177500># ok</span>
</code></pre></div><p>Dataclass with slots:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>from</span> <span style=color:#000>dataclasses</span> <span style=color:#a90d91>import</span> <span style=color:#000>dataclass</span>

<span style=color:#000>@dataclass</span>(<span style=color:#000>slots</span><span style=color:#000>=</span><span style=color:#a90d91>True</span>)
<span style=color:#a90d91>class</span> <span style=color:#3f6e75>SlotPerson</span>:
    <span style=color:#a90d91>id</span>: <span style=color:#a90d91>int</span>
    <span style=color:#000>name</span>: <span style=color:#a90d91>str</span>

<span style=color:#000>bob</span> <span style=color:#000>=</span> <span style=color:#000>SlotPerson</span>(<span style=color:#a90d91>id</span><span style=color:#000>=</span><span style=color:#1c01ce>12</span>, <span style=color:#000>name</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;Bob&#34;</span>)
<span style=color:#000>bob</span><span style=color:#000>.</span><span style=color:#000>__dict__</span>
<span style=color:#177500># AttributeError: &#39;SlotPerson&#39; object has no attribute &#39;__dict__&#39;</span>
<span style=color:#000>bob</span><span style=color:#000>.</span><span style=color:#000>__slots__</span>
<span style=color:#177500># (&#39;id&#39;, &#39;name&#39;)</span>
<span style=color:#000>bob</span><span style=color:#000>.</span><span style=color:#000>salary</span> <span style=color:#000>=</span> <span style=color:#1c01ce>78</span>
<span style=color:#177500># AttributeError: &#39;SlotPerson&#39; object has no attribute &#39;salary&#39;</span>
</code></pre></div><p>Besides, the dataclass can now be forced to accept keyword-only parameters when creating an object (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>from</span> <span style=color:#000>dataclasses</span> <span style=color:#a90d91>import</span> <span style=color:#000>dataclass</span>

<span style=color:#000>@dataclass</span>(<span style=color:#000>kw_only</span><span style=color:#000>=</span><span style=color:#a90d91>True</span>)
<span style=color:#a90d91>class</span> <span style=color:#3f6e75>KeywordPerson</span>:
    <span style=color:#a90d91>id</span>: <span style=color:#a90d91>int</span>
    <span style=color:#000>name</span>: <span style=color:#a90d91>str</span>

<span style=color:#000>diane</span> <span style=color:#000>=</span> <span style=color:#000>KeywordPerson</span>(<span style=color:#a90d91>id</span><span style=color:#000>=</span><span style=color:#1c01ce>11</span>, <span style=color:#000>name</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;Diane&#34;</span>)
<span style=color:#177500># ok</span>
<span style=color:#000>diane</span> <span style=color:#000>=</span> <span style=color:#000>KeywordPerson</span>(<span style=color:#1c01ce>11</span>, <span style=color:#c41a16>&#34;Diane&#34;</span>)
<span style=color:#177500># TypeError: KeywordPerson.__init__() takes 1 positional argument but 3 were given</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717024/step/6>playground</a></p>
<p>Contributed by: <a href=https://github.com/uriyyo>Yurii Karabas</a> • <a href=https://github.com/ericvsmith>Eric V. Smith</a></p>
<h2 id=datetime>datetime</h2>
<p><a href=https://docs.python.org/3/library/datetime><code>datetime</code></a> module (unsurprisingly) deals with date and time.</p>
<p>It received new <a href=https://docs.python.org/3/library/datetime#datetime.date.fromisocalendar><code>date.fromisocalendar()</code></a> and <a href=https://docs.python.org/3/library/datetime#datetime.datetime.fromisocalendar><code>datetime.fromisocalendar()</code></a> constructors, which create a date from the <code>(year, week, week_day)</code> trio (3.8+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>datetime</span> <span style=color:#a90d91>as</span> <span style=color:#000>dt</span>

<span style=color:#000>day</span> <span style=color:#000>=</span> <span style=color:#000>dt</span><span style=color:#000>.</span><span style=color:#000>date</span>(<span style=color:#1c01ce>2022</span>, <span style=color:#1c01ce>9</span>, <span style=color:#1c01ce>13</span>)
<span style=color:#000>day</span><span style=color:#000>.</span><span style=color:#000>isocalendar</span>()
<span style=color:#177500># datetime.IsoCalendarDate(year=2022, week=37, weekday=2)</span>

<span style=color:#000>year</span>, <span style=color:#000>week</span>, <span style=color:#000>day</span> <span style=color:#000>=</span> <span style=color:#000>day</span><span style=color:#000>.</span><span style=color:#000>isocalendar</span>()
<span style=color:#000>next_day</span> <span style=color:#000>=</span> <span style=color:#000>dt</span><span style=color:#000>.</span><span style=color:#000>date</span><span style=color:#000>.</span><span style=color:#000>fromisocalendar</span>(<span style=color:#000>year</span>, <span style=color:#000>week</span>, <span style=color:#000>day</span><span style=color:#000>+</span><span style=color:#1c01ce>1</span>)
<span style=color:#177500># datetime.date(2022, 9, 14)</span>
</code></pre></div><p>Besides, the <code>.isocalendar()</code> method now returns a named <code>IsoCalendarDate</code> instead of the regular tuple (3.9+). You can see it in the example above.</p>
<p><a href=https://stepik.org/lesson/717024/step/7>playground</a></p>
<p>Contributed by: <a href=https://github.com/pganssle>Paul Ganssle</a> • <a href=https://github.com/corona10>Dong-hee Na</a></p>
<h2 id=fractions>fractions</h2>
<p><a href=https://docs.python.org/3/library/fractions><code>fractions</code></a> module works with rational numbers.</p>
<p>It received the <a href=https://docs.python.org/3/library/fractions#fractions.Fraction.as_integer_ratio><code>Fraction.as_integer_ratio()</code></a> method to return a fraction as a <code>(numerator, denominator)</code> pair, thereby fixing the age-old shame of the usual <code>float</code> (3.8+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>(<span style=color:#1c01ce>0.25</span>)<span style=color:#000>.</span><span style=color:#000>as_integer_ratio</span>()
<span style=color:#177500># (1, 4)</span>

(<span style=color:#1c01ce>0.5</span>)<span style=color:#000>.</span><span style=color:#000>as_integer_ratio</span>()
<span style=color:#177500># (1, 2)</span>

(<span style=color:#1c01ce>0.2</span>)<span style=color:#000>.</span><span style=color:#000>as_integer_ratio</span>()
<span style=color:#177500># (3602879701896397, 18014398509481984)</span>
<span style=color:#177500># oopsie</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>from</span> <span style=color:#000>fractions</span> <span style=color:#a90d91>import</span> <span style=color:#000>Fraction</span>

<span style=color:#000>Fraction</span>(<span style=color:#c41a16>&#34;0.2&#34;</span>)<span style=color:#000>.</span><span style=color:#000>as_integer_ratio</span>()
<span style=color:#177500># (1, 5)</span>
<span style=color:#177500># so much better</span>
</code></pre></div><p>To be fair, <code>decimal.Decimal</code> learned to do this back in 3.6. But it&rsquo;s still nice.</p>
<p><a href=https://stepik.org/lesson/717024/step/8>playground</a></p>
<p>Contributed by: <a href=https://github.com/lisroach>Lisa Roach</a> • <a href=https://github.com/rhettinger>Raymond Hettinger</a></p>
<h2 id=functools>functools</h2>
<p><a href=https://docs.python.org/3/library/functools><code>functools</code></a> module is a collection of higher-order auxiliary functions. One of them is <a href=https://docs.python.org/3/library/functools#functools.lru_cache><code>lru_cache()</code></a>, which caches expensive calculations:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>functools</span>
<span style=color:#a90d91>import</span> <span style=color:#000>time</span>

<span style=color:#000>@functools</span><span style=color:#000>.</span><span style=color:#000>lru_cache</span>(<span style=color:#000>maxsize</span><span style=color:#000>=</span><span style=color:#1c01ce>256</span>)
<span style=color:#a90d91>def</span> <span style=color:#000>find_user</span>(<span style=color:#000>name</span>):
    <span style=color:#177500># imitating slow search</span>
    <span style=color:#000>time</span><span style=color:#000>.</span><span style=color:#000>sleep</span>(<span style=color:#1c01ce>1</span>)
    <span style=color:#000>user</span> <span style=color:#000>=</span> {<span style=color:#c41a16>&#34;id&#34;</span>: <span style=color:#1c01ce>11</span>, <span style=color:#c41a16>&#34;name&#34;</span>: <span style=color:#c41a16>&#34;Diane&#34;</span>}
    <span style=color:#a90d91>return</span> <span style=color:#000>user</span>

<span style=color:#000>find_user</span>(<span style=color:#c41a16>&#34;Diane&#34;</span>)
<span style=color:#177500># kinda slow</span>

<span style=color:#000>find_user</span>(<span style=color:#c41a16>&#34;Diane&#34;</span>)
<span style=color:#177500># blazingly fast</span>
</code></pre></div><p>Previously, it required to explicitly set the cache size. And now you can specify <code>@lru_cache</code> without arguments, using the default size of <code>128</code> (3.8+).</p>
<p>Besides, you can get the cache parameters (3.9+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>find_user</span><span style=color:#000>.</span><span style=color:#000>cache_parameters</span>()
<span style=color:#177500># {&#39;maxsize&#39;: 256, &#39;typed&#39;: False}</span>
</code></pre></div><p>If you don&rsquo;t mind the memory usage, you can use the unlimited <a href=https://docs.python.org/3/library/functools#functools.cache><code>@cache</code></a> instead of <code>@lru_cache</code> (3.9+).</p>
<p>New <a href=https://docs.python.org/3/library/functools#functools.cached_property><code>@cached_property</code></a> decorator caches the calculated object property (3.8+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>functools</span>
<span style=color:#a90d91>import</span> <span style=color:#000>statistics</span>

<span style=color:#a90d91>class</span> <span style=color:#3f6e75>Dataset</span>:
    <span style=color:#a90d91>def</span> <span style=color:#000>__init__</span>(<span style=color:#5b269a>self</span>, <span style=color:#000>seq</span>):
        <span style=color:#5b269a>self</span><span style=color:#000>.</span><span style=color:#000>_data</span> <span style=color:#000>=</span> <span style=color:#a90d91>tuple</span>(<span style=color:#000>seq</span>)

    <span style=color:#000>@functools</span><span style=color:#000>.</span><span style=color:#000>cached_property</span>
    <span style=color:#a90d91>def</span> <span style=color:#000>stdev</span>(<span style=color:#5b269a>self</span>):
        <span style=color:#a90d91>return</span> <span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>stdev</span>(<span style=color:#5b269a>self</span><span style=color:#000>.</span><span style=color:#000>_data</span>)

<span style=color:#000>dataset</span> <span style=color:#000>=</span> <span style=color:#000>Dataset</span>(<span style=color:#a90d91>range</span>(<span style=color:#1c01ce>1_000_000</span>))

<span style=color:#000>dataset</span><span style=color:#000>.</span><span style=color:#000>stdev</span>
<span style=color:#177500># kinda slow</span>

<span style=color:#000>dataset</span><span style=color:#000>.</span><span style=color:#000>stdev</span>
<span style=color:#177500># blazingly fast</span>
</code></pre></div><p>And <a href=https://docs.python.org/3/library/functools#functools.singledispatchmethod><code>@singledispatchmethod</code></a> overloads the method depending on the parameter type (3.8+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>functools</span>

<span style=color:#a90d91>class</span> <span style=color:#3f6e75>Divider</span>:
    <span style=color:#000>@functools</span><span style=color:#000>.</span><span style=color:#000>singledispatchmethod</span>
    <span style=color:#a90d91>def</span> <span style=color:#000>divide</span>(<span style=color:#5b269a>self</span>, <span style=color:#000>dividend</span>, <span style=color:#000>divisor</span>):
        <span style=color:#a90d91>raise</span> <span style=color:#000>NotImplementedError</span>(<span style=color:#c41a16>&#34;Do not know how to divide those&#34;</span>)

    <span style=color:#000>@divide</span><span style=color:#000>.</span><span style=color:#000>register</span>
    <span style=color:#a90d91>def</span> <span style=color:#000>_</span>(<span style=color:#5b269a>self</span>, <span style=color:#000>dividend</span>: <span style=color:#a90d91>int</span>, <span style=color:#000>divisor</span>: <span style=color:#a90d91>int</span>):
        <span style=color:#a90d91>return</span> <span style=color:#000>dividend</span> <span style=color:#000>//</span> <span style=color:#000>divisor</span>

    <span style=color:#000>@divide</span><span style=color:#000>.</span><span style=color:#000>register</span>
    <span style=color:#a90d91>def</span> <span style=color:#000>_</span>(<span style=color:#5b269a>self</span>, <span style=color:#000>dividend</span>: <span style=color:#a90d91>str</span>, <span style=color:#000>divisor</span>: <span style=color:#a90d91>int</span>):
        <span style=color:#177500># this is really stupid, I know</span>
        <span style=color:#000>newlen</span> <span style=color:#000>=</span> <span style=color:#a90d91>len</span>(<span style=color:#000>dividend</span>) <span style=color:#000>//</span> <span style=color:#000>divisor</span>
        <span style=color:#a90d91>return</span> <span style=color:#000>dividend</span>[:<span style=color:#000>newlen</span>]

<span style=color:#000>divider</span> <span style=color:#000>=</span> <span style=color:#000>Divider</span>()
<span style=color:#000>divider</span><span style=color:#000>.</span><span style=color:#000>divide</span>(<span style=color:#1c01ce>10</span>, <span style=color:#1c01ce>2</span>)
<span style=color:#177500># 5</span>

<span style=color:#000>divider</span><span style=color:#000>.</span><span style=color:#000>divide</span>(<span style=color:#c41a16>&#34;hello world&#34;</span>, <span style=color:#1c01ce>2</span>)
<span style=color:#177500># &#39;hello&#39;</span>
</code></pre></div><p>Smells like Java to me.</p>
<p><a href=https://stepik.org/lesson/717024/step/9>playground</a></p>
<p>Contributed by: <a href=https://github.com/rhettinger>Raymond Hettinger</a> • <a href=https://github.com/carljm>Carl Meyer</a> • <a href=https://github.com/ethanhs>Ethan Smith</a></p>
<h2 id=glob>glob</h2>
<p><a href=https://docs.python.org/3/library/glob><code>glob</code></a> module searches for files and directories that match the template.</p>
<p>Now thanks to the <code>root_dir</code> parameter in <a href=https://docs.python.org/3/library/glob#glob.glob><code>glob()</code></a> and <a href=https://docs.python.org/3/library/glob#glob.iglob><code>iglob()</code></a> functions you can specify the root directory of the search (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>glob</span>
<span style=color:#a90d91>import</span> <span style=color:#000>os</span>

<span style=color:#000>os</span><span style=color:#000>.</span><span style=color:#000>getcwd</span>()
<span style=color:#177500># &#39;/&#39;</span>

<span style=color:#000>glob</span><span style=color:#000>.</span><span style=color:#000>glob</span>(<span style=color:#c41a16>&#34;*&#34;</span>, <span style=color:#000>root_dir</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;/usr&#34;</span>)
<span style=color:#177500># [&#39;local&#39;, &#39;share&#39;, &#39;bin&#39;, &#39;lib&#39;, &#39;sbin&#39;, &#39;src&#39;]</span>
</code></pre></div><p>It&rsquo;s a small thing, but it&rsquo;s nice.</p>
<p><a href=https://stepik.org/lesson/717024/step/10>playground</a></p>
<p>Contributed by: <a href=https://github.com/serhiy-storchaka>Serhiy Storchaka</a></p>
<h2 id=graphlib>graphlib</h2>
<p><a href=https://docs.python.org/3/library/graphlib><code>graphlib</code></a> module works with graphs. And you know what? This is a brand-new module! (3.9+)</p>
<p>So far, it has only one feature — topological graph sorting (an ordering of vertices such that for any <code>u → v</code>, the vertex <code>u</code> comes before <code>v</code>):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>from</span> <span style=color:#000>graphlib</span> <span style=color:#a90d91>import</span> <span style=color:#000>TopologicalSorter</span>

<span style=color:#000>graph</span> <span style=color:#000>=</span> {<span style=color:#c41a16>&#34;Diane&#34;</span>: {<span style=color:#c41a16>&#34;Bob&#34;</span>, <span style=color:#c41a16>&#34;Cindy&#34;</span>}, <span style=color:#c41a16>&#34;Cindy&#34;</span>: {<span style=color:#c41a16>&#34;Alice&#34;</span>}, <span style=color:#c41a16>&#34;Bob&#34;</span>: {<span style=color:#c41a16>&#34;Alice&#34;</span>}}
<span style=color:#177500># Alice → Bob → Diane</span>
<span style=color:#177500>#     ↳ Cindy ↗</span>

<span style=color:#000>sorter</span> <span style=color:#000>=</span> <span style=color:#000>TopologicalSorter</span>(<span style=color:#000>graph</span>)
<span style=color:#a90d91>list</span>(<span style=color:#000>sorter</span><span style=color:#000>.</span><span style=color:#000>static_order</span>())
<span style=color:#177500># [&#39;Alice&#39;, &#39;Cindy&#39;, &#39;Bob&#39;, &#39;Diane&#39;]</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717025/step/2>playground</a></p>
<p>Contributed by: <a href=https://github.com/pablogsal>Pablo Galindo</a> • <a href=https://github.com/tim-one>Tim Peters</a> • <a href=https://github.com/larryhastings>Larry Hastings</a></p>
<h2 id=itertools>itertools</h2>
<p><a href=https://docs.python.org/3/library/itertools><code>itertools</code></a> module provides a variety of iterators for memory-efficient collection processing.</p>
<p>One of them is the <a href=https://docs.python.org/3/library/itertools#itertools.accumulate><code>accumulate()</code></a> function, which calculates the rolling aggregate. Now it allows the <code>initial</code> parameter, which sets the initial value (3.8+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>itertools</span>

<span style=color:#000>seq</span> <span style=color:#000>=</span> [<span style=color:#1c01ce>7</span>, <span style=color:#1c01ce>11</span>, <span style=color:#1c01ce>19</span>, <span style=color:#1c01ce>42</span>]

<span style=color:#000>accumulator</span> <span style=color:#000>=</span> <span style=color:#000>itertools</span><span style=color:#000>.</span><span style=color:#000>accumulate</span>(<span style=color:#000>seq</span>)
<span style=color:#a90d91>list</span>(<span style=color:#000>accumulator</span>)
<span style=color:#177500># [7, 18, 37, 79]</span>

<span style=color:#000>accumulator</span> <span style=color:#000>=</span> <span style=color:#000>itertools</span><span style=color:#000>.</span><span style=color:#000>accumulate</span>(<span style=color:#000>seq</span>, <span style=color:#000>initial</span><span style=color:#000>=</span><span style=color:#1c01ce>100</span>)
<span style=color:#a90d91>list</span>(<span style=color:#000>accumulator</span>)
<span style=color:#177500># [100, 107, 118, 137, 179]</span>
</code></pre></div><p>And the shiny new <a href=https://docs.python.org/3/library/itertools#itertools.pairwise><code>pairwise()</code></a> function traverses the collection and yields pairs of consecutive elements (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>itertools</span>

<span style=color:#000>seq</span> <span style=color:#000>=</span> [<span style=color:#1c01ce>7</span>, <span style=color:#1c01ce>11</span>, <span style=color:#1c01ce>19</span>, <span style=color:#1c01ce>42</span>]
<span style=color:#000>pairer</span> <span style=color:#000>=</span> <span style=color:#000>itertools</span><span style=color:#000>.</span><span style=color:#000>pairwise</span>(<span style=color:#000>seq</span>)

<span style=color:#a90d91>list</span>(<span style=color:#000>pairer</span>)
<span style=color:#177500># [(7, 11), (11, 19), (19, 42)]</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717025/step/3>playground</a></p>
<p>Contributed by: <a href=https://github.com/lisroach>Lisa Roach</a> • <a href=https://github.com/rhettinger>Raymond Hettinger</a></p>
<h2 id=math>math</h2>
<p><a href=https://docs.python.org/3/library/math><code>math</code></a> module includes an abundance of mathematical functions.</p>
<p>There are a lot of news here:</p>
<ul>
<li><a href=https://docs.python.org/3/library/math#math.dist><code>dist()</code></a> calculates the Euclidean distance between points (3.8+);</li>
<li><a href=https://docs.python.org/3/library/math#math.perm><code>perm()</code></a> and <a href=https://docs.python.org/3/library/math#math.comb><code>comb()</code></a> count the number of permutations and combinations (3.8+);</li>
<li><a href=https://docs.python.org/3/library/math#math.lcm><code>lcm()</code></a> computes the least common multiple (3.9+);</li>
<li><a href=https://docs.python.org/3/library/math#math.gcd><code>gcd()</code></a> now computes the greatest common divisor for an arbitrary number of arguments (3.9+).</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>math</span>

<span style=color:#000>math</span><span style=color:#000>.</span><span style=color:#000>dist</span>((<span style=color:#1c01ce>1</span>,<span style=color:#1c01ce>1</span>), (<span style=color:#1c01ce>4</span>, <span style=color:#1c01ce>5</span>))
<span style=color:#177500># 5.0</span>

<span style=color:#000>math</span><span style=color:#000>.</span><span style=color:#000>perm</span>(<span style=color:#1c01ce>5</span>, <span style=color:#1c01ce>2</span>)
<span style=color:#177500># 20</span>

<span style=color:#000>math</span><span style=color:#000>.</span><span style=color:#000>comb</span>(<span style=color:#1c01ce>5</span>, <span style=color:#1c01ce>2</span>)
<span style=color:#177500># 10</span>

<span style=color:#000>math</span><span style=color:#000>.</span><span style=color:#000>lcm</span>(<span style=color:#1c01ce>9</span>, <span style=color:#1c01ce>27</span>, <span style=color:#1c01ce>60</span>)
<span style=color:#177500># 540</span>

<span style=color:#000>math</span><span style=color:#000>.</span><span style=color:#000>gcd</span>(<span style=color:#1c01ce>9</span>, <span style=color:#1c01ce>27</span>, <span style=color:#1c01ce>60</span>)
<span style=color:#177500># 3</span>
</code></pre></div><p>And <a href=https://docs.python.org/3/library/math#math.prod><code>prod()</code></a> multiplies the sequence elements (3.8+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>math</span>

<span style=color:#000>seq</span> <span style=color:#000>=</span> <span style=color:#a90d91>range</span>(<span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>9</span>)
<span style=color:#000>math</span><span style=color:#000>.</span><span style=color:#000>prod</span>(<span style=color:#000>seq</span>)
<span style=color:#177500># 20160</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717025/step/4>playground</a></p>
<p>Contributed by: <a href=https://github.com/rhettinger>Raymond Hettinger</a> • <a href=https://github.com/FR4NKESTI3N>Yash Aggarwal</a> • <a href=https://github.com/KellerFuchs>Keller Fuchs</a> • <a href=https://github.com/serhiy-storchaka>Serhiy Storchaka</a> • <a href=https://github.com/mdickinson>Mark Dickinson</a> • <a href=https://github.com/ananthan-123>Ananthakrishnan</a> • <a href=https://github.com/pablogsal>Pablo Galindo</a></p>
<h2 id=random>random</h2>
<p><a href=https://docs.python.org/3/library/random><code>random</code></a> module handles random numbers.</p>
<p>New <a href=https://docs.python.org/3/library/random#random.randbytes><code>randbytes()</code></a> method generates a random byte string (3.9+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>random</span>

<span style=color:#000>random</span><span style=color:#000>.</span><span style=color:#000>randbytes</span>(<span style=color:#1c01ce>4</span>)
<span style=color:#177500># b&#39;\x8b\xd4\x8f\xc9&#39;</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717025/step/5>playground</a></p>
<p>Contributed by: <a href=https://github.com/vstinner>Victor Stinner</a></p>
<h2 id=shlex>shlex</h2>
<p><a href=https://docs.python.org/3/library/shlex><code>shlex</code></a> module splits the string into tokens according to the Unix command line rules.</p>
<p>And now it also joins the tokens back into the string — thanks to the <a href=https://docs.python.org/3/library/shlex#shlex.join><code>join()</code></a> function (3.8+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>shlex</span>

<span style=color:#000>tokens</span> <span style=color:#000>=</span> [<span style=color:#c41a16>&#34;echo&#34;</span>, <span style=color:#c41a16>&#34;-n&#34;</span>, <span style=color:#c41a16>&#34;Python is awesome&#34;</span>]
<span style=color:#000>shlex</span><span style=color:#000>.</span><span style=color:#000>join</span>(<span style=color:#000>tokens</span>)
<span style=color:#177500># &#34;echo -n &#39;Python is awesome&#39;&#34;</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717025/step/6>playground</a></p>
<p>Contributed by: <a href=https://github.com/bbayles>Bo Bayles</a></p>
<h2 id=shutil>shutil</h2>
<p><a href=https://docs.python.org/3/library/shutil><code>shutil</code></a> module works with files and directories: copies, moves and deletes them.</p>
<p>Copying directories has now become a little more convenient — kudos to the <code>dirs_exist_ok</code> parameter in the <a href=https://docs.python.org/3/library/shutil#shutil.copytree><code>copytree()</code></a> function (3.8+). If it is on, the function allows the target directory to exist:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>from</span> <span style=color:#000>pathlib</span> <span style=color:#a90d91>import</span> <span style=color:#000>Path</span>
<span style=color:#a90d91>import</span> <span style=color:#000>shutil</span>

<span style=color:#000>tmp</span> <span style=color:#000>=</span> <span style=color:#000>Path</span>(<span style=color:#c41a16>&#34;/tmp&#34;</span>)

<span style=color:#000>src</span> <span style=color:#000>=</span> <span style=color:#000>tmp</span><span style=color:#000>.</span><span style=color:#000>joinpath</span>(<span style=color:#c41a16>&#34;src&#34;</span>)
<span style=color:#000>src</span><span style=color:#000>.</span><span style=color:#000>mkdir</span>()
<span style=color:#000>src</span><span style=color:#000>.</span><span style=color:#000>joinpath</span>(<span style=color:#c41a16>&#34;src.txt&#34;</span>)<span style=color:#000>.</span><span style=color:#000>touch</span>()
<span style=color:#177500># /tmp/src</span>
<span style=color:#177500># /tmp/src/src.txt</span>

<span style=color:#000>dst</span> <span style=color:#000>=</span> <span style=color:#000>tmp</span><span style=color:#000>.</span><span style=color:#000>joinpath</span>(<span style=color:#c41a16>&#34;dst&#34;</span>)
<span style=color:#000>dst</span><span style=color:#000>.</span><span style=color:#000>mkdir</span>()
<span style=color:#177500># /tmp/dst</span>

<span style=color:#000>shutil</span><span style=color:#000>.</span><span style=color:#000>copytree</span>(<span style=color:#000>src</span>, <span style=color:#000>dst</span>)
<span style=color:#177500># FileExistsError: [Errno 17] File exists: &#39;/tmp/dst&#39;</span>
<span style=color:#000>shutil</span><span style=color:#000>.</span><span style=color:#000>copytree</span>(<span style=color:#000>src</span>, <span style=color:#000>dst</span>, <span style=color:#000>dirs_exist_ok</span><span style=color:#000>=</span><span style=color:#a90d91>True</span>)
<span style=color:#177500># PosixPath(&#39;/tmp/dst&#39;)</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717025/step/7>playground</a></p>
<p>Contributed by: <a href=https://github.com/jab>Josh Bronson</a></p>
<h2 id=statistics>statistics</h2>
<p><a href=https://docs.python.org/3/library/statistics><code>statistics</code></a> module handles mathematical statistics. Like <code>math</code>, it has greatly improved in recent releases. Not <code>scipy</code> yet, but it&rsquo;s not the kindergarten version Python had in 3.4.</p>
<p>See for yourself:</p>
<ul>
<li><a href=https://docs.python.org/3/library/statistics#statistics.fmean><code>fmean()</code></a> computes the arithmetic mean (like <code>mean()</code>, only faster) (3.8+);</li>
<li><a href=https://docs.python.org/3/library/statistics#statistics.geometric_mean><code>geometric_mean()</code></a> computes the geometric mean (3.8+);</li>
<li><a href=https://docs.python.org/3/library/statistics#statistics.multimode><code>multimode()</code></a> returns the modes (the most frequent values in the dataset), even if there are multiple ones (in contrast to <code>mode()</code>) (3.8+);</li>
<li><a href=https://docs.python.org/3/library/statistics#statistics.quantiles><code>quantiles()</code></a> splits the dataset into quantiles and returns the cut points (3.8+).</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>statistics</span>

<span style=color:#000>seq</span> <span style=color:#000>=</span> <span style=color:#a90d91>list</span>(<span style=color:#a90d91>range</span>(<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>10</span>))

<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>fmean</span>(<span style=color:#000>seq</span>)
<span style=color:#177500># 5.0</span>

<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>geometric_mean</span>(<span style=color:#000>seq</span>)
<span style=color:#177500># 4.147166274396913</span>

<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>multimode</span>(<span style=color:#000>seq</span>)
<span style=color:#177500># [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>multimode</span>(<span style=color:#c41a16>&#34;python is awesome&#34;</span>)
<span style=color:#177500># [&#39;o&#39;, &#39; &#39;, &#39;s&#39;, &#39;e&#39;]</span>

<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>quantiles</span>(<span style=color:#000>seq</span>)
<span style=color:#177500># [2.5, 5.0, 7.5]</span>
</code></pre></div><p><a href=https://docs.python.org/3/library/statistics#statistics.NormalDist><code>NormalDist</code></a> describes the normal distribution of a random variable (3.8+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>from</span> <span style=color:#000>statistics</span> <span style=color:#a90d91>import</span> <span style=color:#000>NormalDist</span>

<span style=color:#000>birth_weights</span> <span style=color:#000>=</span> <span style=color:#000>NormalDist</span><span style=color:#000>.</span><span style=color:#000>from_samples</span>([<span style=color:#1c01ce>2.5</span>, <span style=color:#1c01ce>3.1</span>, <span style=color:#1c01ce>2.1</span>, <span style=color:#1c01ce>2.4</span>, <span style=color:#1c01ce>2.7</span>, <span style=color:#1c01ce>3.5</span>])
<span style=color:#000>drug_effects</span> <span style=color:#000>=</span> <span style=color:#000>NormalDist</span>(<span style=color:#1c01ce>0.4</span>, <span style=color:#1c01ce>0.15</span>)
<span style=color:#000>combined</span> <span style=color:#000>=</span> <span style=color:#000>birth_weights</span> <span style=color:#000>+</span> <span style=color:#000>drug_effects</span>

<span style=color:#a90d91>round</span>(<span style=color:#000>combined</span><span style=color:#000>.</span><span style=color:#000>mean</span>, <span style=color:#1c01ce>1</span>)
<span style=color:#177500># 3.1</span>

<span style=color:#a90d91>round</span>(<span style=color:#000>combined</span><span style=color:#000>.</span><span style=color:#000>stdev</span>, <span style=color:#1c01ce>1</span>)
<span style=color:#177500># 0.5</span>
</code></pre></div><p>The module received Pearson <a href=https://docs.python.org/3/library/statistics#statistics.correlation><code>correlation()</code></a> and <a href=https://docs.python.org/3/library/statistics#statistics.covariance><code>covariance()</code></a> functions (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>statistics</span>

<span style=color:#000>x</span> <span style=color:#000>=</span> [<span style=color:#1c01ce>1</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>4</span>, <span style=color:#1c01ce>5</span>, <span style=color:#1c01ce>6</span>, <span style=color:#1c01ce>7</span>, <span style=color:#1c01ce>8</span>, <span style=color:#1c01ce>9</span>]
<span style=color:#000>y</span> <span style=color:#000>=</span> [<span style=color:#1c01ce>9</span>, <span style=color:#1c01ce>8</span>, <span style=color:#1c01ce>7</span>, <span style=color:#1c01ce>6</span>, <span style=color:#1c01ce>5</span>, <span style=color:#1c01ce>4</span>, <span style=color:#1c01ce>3</span>, <span style=color:#1c01ce>2</span>, <span style=color:#1c01ce>1</span>]

<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>correlation</span>(<span style=color:#000>x</span>, <span style=color:#000>x</span>)
<span style=color:#177500># 1.0</span>

<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>correlation</span>(<span style=color:#000>x</span>, <span style=color:#000>y</span>)
<span style=color:#177500># -1.0</span>

<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>covariance</span>(<span style=color:#000>x</span>, <span style=color:#000>x</span>)
<span style=color:#177500># 7.5</span>

<span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>covariance</span>(<span style=color:#000>x</span>, <span style=color:#000>y</span>)
<span style=color:#177500># -7.5</span>
</code></pre></div><p>And even the <a href=https://docs.python.org/3/library/statistics#statistics.linear_regression><code>linear_regression()</code></a> calculator (3.10+):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>statistics</span>

<span style=color:#000>movies_by_year</span> <span style=color:#000>=</span> {
    <span style=color:#1c01ce>2000</span>: <span style=color:#1c01ce>371</span>,
    <span style=color:#1c01ce>2003</span>: <span style=color:#1c01ce>507</span>,
    <span style=color:#1c01ce>2006</span>: <span style=color:#1c01ce>608</span>,
    <span style=color:#1c01ce>2009</span>: <span style=color:#1c01ce>520</span>,
    <span style=color:#1c01ce>2012</span>: <span style=color:#1c01ce>669</span>,
    <span style=color:#1c01ce>2015</span>: <span style=color:#1c01ce>708</span>,
    <span style=color:#1c01ce>2018</span>: <span style=color:#1c01ce>873</span>,
    <span style=color:#1c01ce>2021</span>: <span style=color:#1c01ce>403</span>,
}

<span style=color:#000>x</span> <span style=color:#000>=</span> <span style=color:#000>movies_by_year</span><span style=color:#000>.</span><span style=color:#000>keys</span>()
<span style=color:#000>y</span> <span style=color:#000>=</span> <span style=color:#000>movies_by_year</span><span style=color:#000>.</span><span style=color:#000>values</span>()
<span style=color:#000>slope</span>, <span style=color:#000>intercept</span> <span style=color:#000>=</span> <span style=color:#000>statistics</span><span style=color:#000>.</span><span style=color:#000>linear_regression</span>(<span style=color:#000>x</span>, <span style=color:#000>y</span>)

<span style=color:#000>year_2022</span> <span style=color:#000>=</span> <span style=color:#a90d91>round</span>(<span style=color:#000>slope</span> <span style=color:#000>*</span> <span style=color:#1c01ce>2022</span> <span style=color:#000>+</span> <span style=color:#000>intercept</span>)
<span style=color:#177500># 697</span>
</code></pre></div><p>By the way, the <code>statistics</code> module is also famous for its excellent documentation. Check it out.</p>
<p><a href=https://stepik.org/lesson/717025/step/8>playground</a></p>
<p>Contributed by: <a href=https://github.com/rhettinger>Raymond Hettinger</a> • <a href=https://github.com/stevendaprano>Steven D’Aprano</a> • <a href=https://github.com/twolodzko>Timothy Wolodzko</a></p>
<h2 id=zoneinfo>zoneinfo</h2>
<p><a href=https://docs.python.org/3/library/zoneinfo><code>zoneinfo</code></a> module provides information about time zones around the world. Another new module! (3.9+)</p>
<p>Before the <code>zoneinfo</code> appearance, Python had a single ascetic <code>timezone.utc</code> time zone. Well, not anymore:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>import</span> <span style=color:#000>datetime</span> <span style=color:#a90d91>as</span> <span style=color:#000>dt</span>
<span style=color:#a90d91>from</span> <span style=color:#000>zoneinfo</span> <span style=color:#a90d91>import</span> <span style=color:#000>ZoneInfo</span>

<span style=color:#000>utc</span> <span style=color:#000>=</span> <span style=color:#000>dt</span><span style=color:#000>.</span><span style=color:#000>datetime</span>(<span style=color:#1c01ce>2022</span>, <span style=color:#1c01ce>9</span>, <span style=color:#1c01ce>13</span>, <span style=color:#000>hour</span><span style=color:#000>=</span><span style=color:#1c01ce>21</span>, <span style=color:#000>tzinfo</span><span style=color:#000>=</span><span style=color:#000>dt</span><span style=color:#000>.</span><span style=color:#000>timezone</span><span style=color:#000>.</span><span style=color:#000>utc</span>)
<span style=color:#177500># 2022-09-13 21:00:00+00:00</span>

<span style=color:#000>paris</span> <span style=color:#000>=</span> <span style=color:#000>utc</span><span style=color:#000>.</span><span style=color:#000>astimezone</span>(<span style=color:#000>ZoneInfo</span>(<span style=color:#c41a16>&#34;Europe/Paris&#34;</span>))
<span style=color:#177500># 2022-09-13 23:00:00+02:00</span>

<span style=color:#000>tokyo</span> <span style=color:#000>=</span> <span style=color:#000>utc</span><span style=color:#000>.</span><span style=color:#000>astimezone</span>(<span style=color:#000>ZoneInfo</span>(<span style=color:#c41a16>&#34;Asia/Tokyo&#34;</span>))
<span style=color:#177500># 2022-09-14 06:00:00+09:00</span>

<span style=color:#000>sydney</span> <span style=color:#000>=</span> <span style=color:#000>utc</span><span style=color:#000>.</span><span style=color:#000>astimezone</span>(<span style=color:#000>ZoneInfo</span>(<span style=color:#c41a16>&#34;Australia/Sydney&#34;</span>))
<span style=color:#177500># 2022-09-14 07:00:00+10:00</span>
</code></pre></div><p><a href=https://stepik.org/lesson/717025/step/9>playground</a></p>
<p>Contributed by: <a href=https://github.com/pganssle>Paul Ganssle</a></p>
<h2 id=summary>Summary</h2>
<p>We have reviewed as many as 17 modules contributed by 27 devs — and this is without taking into account <code>asyncio</code>, <code>typing</code> and many other lower-level ones. As you can see, the standard library is actively developing. And the new features are quite reasonable. I hope you will find the described novelties useful!</p>
<p>I would also like to specifically thank the contributors for their amazing work:</p>
<ul>
<li><a href=https://twitter.com/carljm>Carl Meyer</a> for the <code>functools.cached_property()</code> decorator;</li>
<li><a href=https://github.com/sweeneyde>Dennis Sweeney</a> for the <code>str.removeprefix()</code> and <code>str.removesuffix()</code> methods;</li>
<li><a href=https://twitter.com/ethanhs>Ethan Smith</a> for the <code>functools.singledispatchmethod()</code> decorator;</li>
<li><a href=https://twitter.com/missingclara>Filipe Laíns</a> for the <code>base64.b32hexencode()</code> and <code>base64.b32hexdecode()</code> functions;</li>
<li><a href=https://twitter.com/lisroach>Lisa Roach</a> for the <code>Fraction.as_integer_ratio()</code> method and <code>itertools.accumulate()</code> improvements;</li>
<li><a href=https://twitter.com/niklasfiekas>Niklas Fiekas</a> for the <code>int.bit_count()</code> method;</li>
<li><a href=https://twitter.com/pyblogsal>Pablo Galindo</a> for the whole <code>graphlib</code> module and <code>math.prod()</code> function;</li>
<li><a href=https://twitter.com/pganssle>Paul Ganssle</a> for the whole <code>zoneinfo</code> module;</li>
<li><a href=https://twitter.com/raymondh>Raymond Hettinger</a> for lots of functions in the <code>statistics</code> module, <code>itertools.pairwise()</code> function, <code>key</code> parameter in the <code>bisect</code> module and his community work;</li>
<li><a href=https://twitter.com/serhiystorchaka>Serhiy Storchaka</a> and <a href=https://github.com/FR4NKESTI3N>Yash Aggarwal</a> for the combinatorics in the <code>math</code> module;</li>
<li><a href=https://twitter.com/tymwol>Timothy Wolodzko</a> for the <code>covariance()</code>, <code>correlation()</code>, and <code>linear_regression()</code> functions in the <code>statistics</code> module;</li>
<li><a href=https://twitter.com/victorstinner>Victor Stinner</a> for the <code>random.randbytes()</code> method.</li>
</ul>
<p><em>Follow <a href=https://twitter.com/ohmypy><strong>@ohmypy</strong></a> on Twitter to keep up with new posts</em> 🚀</p>
</div>
</div><footer class=post__footer>
<div class=row>
<div class=col-xs-12>
<div class=post__date>
<time datetime="2022-05-11 12:40:00 +0000 UTC">11 May, 2022</time>
</div>
<div class=post__tags>
<a href=https://antonz.org/tags/python/>python</a>&nbsp;
</div>
</div>
</div>
</footer></article>
<aside class=post__related>
<div class="post__nav article">
<div class=row>
<div class="col-xs-12 col-sm-6">
<p>&larr;&nbsp;<a href=https://antonz.org/storing-state/>Storing state in the URL</a></p>
</div>
<div class="col-xs-12 col-sm-6">
<p><a href=https://antonz.org/compact-objects/>Compact objects in Python</a>&nbsp;&rarr;</p>
</div>
</div>
</div>
<div class=article>
<div class=row>
<div class="col-xs-12 col-sm-8 col-md-6">
<h3>See also</h3>
<p><a href=/page-iterator/>Page iterator in Python</a></p>
<p><a href=/functools-cache/>Caching slow functions in Python</a></p>
<p><a href=/list-internals/>How Python List Works</a></p>
</div>
</div>
</div>
</aside>
</div>
</div>
<footer class="container footer">
<ul class=naked-list>
<li class=footer__item>Subscribe:
<a href=https://twitter.com/ohmypy class=footer__social-link><i class="fab fa-twitter"></i><span>Twitter</span></a>
<a href=/index.xml class=footer__social-link><i class="fas fa-rss"></i><span>RSS</span></a>
</li>
<li class=footer__item>Email: <a href=mailto:m@antonz.org>m@antonz.org</a></li>
</ul>
</footer>
<script async src=//gc.zgo.at/count.js data-goatcounter=https://antonzorg.goatcounter.com/count></script></body>
</html>
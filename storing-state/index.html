<!doctype html><html lang=en>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Storing state in the URL</title>
<meta name=description content="So that the app does not reset to zero after page refresh.">
<meta name=robots content="index, follow">
<link rel=stylesheet type=text/css href=/assets/css/style.65f0a52d2e69e5dbfd825b3072b88215fc0b75fca7c9690febf6b43535d86a5e.css>
<link rel=icon href=/assets/favicon/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=/assets/favicon/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=/assets/favicon/favicon-32x32.png>
<link rel=apple-touch-icon href=/assets/favicon/apple-touch-icon.png>
<link rel=mask-icon href=/assets/favicon/safari-pinned-tab.svg>
<meta name=theme-color content="#fff">
<meta name=msapplication-TileColor content="#fff">
<link rel=canonical href=https://antonz.org/storing-state/>
<meta name=author content="Anton Zhiyanov">
<meta property="og:type" content="article">
<meta property="og:title" content="Storing state in the URL">
<meta property="og:description" content="So that the app does not reset to zero after page refresh.">
<meta property="og:url" content="https://antonz.org/storing-state/">
<meta property="og:image" content="https://antonz.org/storing-state/cover.png">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:title content="Storing state in the URL">
<meta name=twitter:description content="So that the app does not reset to zero after page refresh.">
<meta name=twitter:url content="https://antonz.org/storing-state/">
<meta name=twitter:site content="@ohmypy">
<meta name=twitter:image content="https://antonz.org/storing-state/cover.png"></head>
<body>
<div class=header>
<div class=container>
<div class=row>
<div class="col-xs-6 col-sm-3">
<a class=img-link href=/>
<img src=/assets/logo.svg class=header-icon>
</a>Â 
<a href=/>
<strong>Anton Zhiyanov</strong>
</a>
</div>
<div class="col-xs-12 col-sm-6 col-md-4 hidden-mobile">
<a class=menu__link href=/all/>
<span>blog</span>
</a>
<a class=menu__link href=/#about>
<span>contacts</span>
</a>
<a class=menu__link href=https://antonz.ru>
<span>ru</span>
</a>
</div>
</div>
</div>
</div>
<div class=storey>
<div class=container>
<article class=post>
<div class=row>
<div class="col-xs-12 col-sm-10 article">
<header>
<h1>Storing state in the URL</h1>
</header>
<p>If you are developing a web application, sooner or later you will face the problem of saving the local system state for the user.</p>
<p>Imagine you sell elite potatoes over the Internet. The buyer visits the website and enters the search criteria:</p>
<ul>
<li>strictly from Bolivia or South Africa,</li>
<li>harvest of 2022,</li>
<li>tuber size from 3 to 7 cm,</li>
<li>preferably in the form of a sea seal.</li>
</ul>
<p>The buyer then receives a list of 300 items (seal-shaped potatoes are quite popular in South Africa), split into 6 pages of 50 items each. They load the third page, open the potato card and freeze in silent admiration for a few seconds. And then accidentally refresh the page. What will your application do?</p>
<p>It depends on how the application stores the filter state. Let&rsquo;s look at the options, and then consider one of them in more detail.</p>
<h2 id=how-to-store-state>How to store state</h2>
<p>JavaScript applications traditionally work with local state in the form of in-memory objects. This is convenient because it supports complex data structures without storage limits, and one does not have to deal with serialization. But will it suit our potato shop? Let&rsquo;s figure it out.</p>
<h3 id=dont-store-state-at-all>Don&rsquo;t store state at all</h3>
<p>Let&rsquo;s say you didn&rsquo;t bother to store the state and keep it in memory. Then after page reload the current context will be lost. The user will be redirected to the main page, where they will stare in disbelief at the giant &ldquo;ELITE POTATOES&rdquo; heading.</p>
<p>This is how Google calendar used to behave. No matter how you navigate around the calendar, no matter what filters you apply, the URL always stayed the same:</p>
<pre><code>https://www.google.com/calendar/render
</code></pre>
<p>Refresh the page â€” and the calendar happily resets to the current week. Ouch.</p>
<h3 id=store-state-locally>Store state locally</h3>
<p>Most services understand that it is not OK to lose context after page refresh. They store the state on the client side (using Web Storage, IndexedDB or other means). This solves the problem with page refreshes, but still won&rsquo;t help with bookmarking.</p>
<p>Plus, such approach creates a problem with conflicting state changes. I opened two browser tabs, went to your potato website, searched for &ldquo;young potatoes&rdquo; in the first tab and for &ldquo;bushy leaves&rdquo; in the second one. Which query will the app remember?</p>
<h3 id=store-a-set-of-url-parameters>Store a set of URL parameters</h3>
<p>Ever since the days when the dynamic nature of websites was limited to the <code>&lt;blink></code> tag, some considered a best practice to store the state in the URL (<em>URL parameters</em>, also known as <em>GET parameters</em> or <em>query string</em>). Such URL is great for emailing or bookmarking â€” there is no problem restoring the context:</p>
<pre><code>https://potato.shop/catalog/?search=wild+potatoes&amp;country=bo,za&amp;size=3-7&amp;page=5
</code></pre>
<p>URL state makes each browser tab completely independent. No shared data in the local storage means no conflicts. It simplifies developer&rsquo;s life, and the user does not have to scratch their head over the mysterious system glitches.</p>
<h3 id=store-serialized-state>Store serialized state</h3>
<p>URL parameters do an excellent job with scalar values (strings, numbers, booleans). But they are less suitable for collections and more complex structures. That&rsquo;s why programmers sometimes do this:</p>
<ul>
<li>represent the state in the form of a dictionary;</li>
<li>serialize it to Base64;</li>
<li>pass it as the single URL parameter.</li>
</ul>
<p>For example, for this state:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#000>&#34;search&#34;</span>: <span style=color:#c41a16>&#34;wild potatoes&#34;</span>,
    <span style=color:#000>&#34;country&#34;</span>: [<span style=color:#c41a16>&#34;bo&#34;</span>, <span style=color:#c41a16>&#34;za&#34;</span>],
    <span style=color:#000>&#34;size&#34;</span>: { <span style=color:#000>&#34;min&#34;</span>: <span style=color:#1c01ce>3</span>, <span style=color:#000>&#34;max&#34;</span>: <span style=color:#1c01ce>7</span> },
    <span style=color:#000>&#34;page&#34;</span>: <span style=color:#1c01ce>5</span>
}
</code></pre></div><p>One will get this URL:</p>
<pre><code>https://potato.shop/catalog/?state=eyJzZWFyY2giOiJ3aWxkIHBvdGF0b2VzIiwiY291bnRyeSI6WyJibyIsInphIl0sInNpemUiOnsibWluIjozLCJtYXgiOjd9LCJwYWdlIjo1fQ==
</code></pre>
<h3 id=hybrid-approaches>Hybrid approaches</h3>
<p>One can store only the main parameters in the URL, and additional ones in the local storage:</p>
<pre><code>https://potato.shop/catalog/?search=wild+potatoes&amp;page=10
</code></pre>
<p>One can pass the main parameters explicitly, and the additional ones as the serialized blob:</p>
<pre><code>https://potato.shop/catalog/?search=wild+potatoes&amp;state=eyJjb3VudHJ5IjpbImJvIiwiemEiXSwic2l6ZSI6eyJtaW4iOjMsIm1heCI6N30sInBhZ2UiOjV9
</code></pre>
<p>There are also more creative options.</p>
<p>For example, one can store the state of the potato list locally. When a visitor requests a specific potato item, open it in a new tab â€” to not bother restoring the list state later.</p>
<p>Or one can implement an URL shortener of sorts. Store the full state on the server, generate a unique link like <code>https://potato.shop/catalog/xKda7</code> and serve it to the client.</p>
<p>We have sorted out the options, now let&rsquo;s look at one of them in more detail.</p>
<h2 id=how-to-store-state-in-url-parameters>How to store state in URL parameters</h2>
<p>At first glance, storing the state as a set of URL parameters is all nice and easy.</p>
<p>State:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#000>&#34;search&#34;</span>: <span style=color:#c41a16>&#34;wild potatoes&#34;</span>,
    <span style=color:#000>&#34;page&#34;</span>: <span style=color:#1c01ce>5</span>
}
</code></pre></div><p>URL params (this and further examples do not use url escaping):</p>
<pre><code>?search=wild+potatoes&amp;page=5
</code></pre>
<p>Indeed, it is easy to pass strings and numbers in the parameters. It gets more interesting with other data types.</p>
<h3 id=boolean-value>Boolean value</h3>
<p>Booleans are typically passed as <code>true</code> / <code>false</code> or <code>1</code> / <code>0</code>.</p>
<p>State:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#000>&#34;search&#34;</span>: <span style=color:#c41a16>&#34;potatoes&#34;</span>,
    <span style=color:#000>&#34;popular&#34;</span>: <span style=color:#a90d91>true</span>
}
</code></pre></div><p>URL params:</p>
<pre><code>?search=potatoes&amp;popular=true
?search=potatoes&amp;popular=1
</code></pre>
<h3 id=date-and-time>Date and time</h3>
<p>Date/time typically uses <a href=https://datatracker.ietf.org/doc/html/rfc3339>RFCÂ 3339</a> (<code>2020-01-02T10:11:12Z</code>) or <a href=https://en.wikipedia.org/wiki/Unix_time>UnixÂ Time</a> (seconds after midnight 01/01/1970).</p>
<p>State (since the example is in JSON, I pass the date in RFC3339; your language has a native representation):</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#000>&#34;search&#34;</span>: <span style=color:#c41a16>&#34;potatoes&#34;</span>,
    <span style=color:#000>&#34;after&#34;</span>: <span style=color:#c41a16>&#34;2020-01-02T10:11:12Z&#34;</span>
}
</code></pre></div><p>URL params:</p>
<pre><code>?search=potatoes&amp;after=2020-01-02T10:11:12Z
?search=potatoes&amp;after=1577959872
</code></pre>
<p>Unix time in milliseconds is less common:</p>
<pre><code>?search=potatoes&amp;after=1577959872000
</code></pre>
<h3 id=empty-value>Empty value</h3>
<p>If some property is not set, it is usually passed empty, or not passed at all.</p>
<p>State:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#000>&#34;search&#34;</span>: <span style=color:#c41a16>&#34;potatoes&#34;</span>,
    <span style=color:#000>&#34;country&#34;</span>: <span style=color:#a90d91>null</span>
}
</code></pre></div><p>URL params:</p>
<pre><code>?search=potatoes&amp;country=
?search=potatoes
</code></pre>
<p>Sometimes devs use a special empty value (e.g. <code>null</code>):</p>
<pre><code>?search=potatoes&amp;country=null
</code></pre>
<h3 id=list-array>List (array)</h3>
<p>So far we have been dealing with scalar values. It becomes more fun with lists.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#000>&#34;search&#34;</span>: <span style=color:#c41a16>&#34;potatoes&#34;</span>,
    <span style=color:#000>&#34;country&#34;</span>: [<span style=color:#c41a16>&#34;bo&#34;</span>, <span style=color:#c41a16>&#34;za&#34;</span>]
}
</code></pre></div><p>The classic option is to repeat the property name for each value, as dictated by <a href=https://datatracker.ietf.org/doc/html/rfc6570#section-2.4.2>RFCÂ 6570</a>:</p>
<pre><code>?search=potatoes&amp;country=bo&amp;country=za
</code></pre>
<p>Sometimes a <code>[]</code> is added to stress the list nature:</p>
<pre><code>?search=potatoes&amp;country[]=bo&amp;country[]=za
</code></pre>
<p>Sometimes even with an index:</p>
<pre><code>?search=potatoes&amp;country[0]=bo&amp;country[1]=za
</code></pre>
<p>Brevity fans pass the property name once, and separate the values with a comma:</p>
<pre><code>?search=potatoes&amp;country=bo,za
</code></pre>
<h3 id=dictionary-map>Dictionary (map)</h3>
<p>A list includes a set of values. A dictionary contains nested properties:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#000>&#34;search&#34;</span>: <span style=color:#c41a16>&#34;potatoes&#34;</span>,
    <span style=color:#000>&#34;size&#34;</span>: { <span style=color:#000>&#34;min&#34;</span>: <span style=color:#1c01ce>3</span>, <span style=color:#000>&#34;max&#34;</span>: <span style=color:#1c01ce>7</span> }
}
</code></pre></div><p>Internet standards do not mention passing composite objects in the URL. So the developers have invented their own options.</p>
<p>Most often people repeat the top-level property name and pass nested property names in <code>[]</code>:</p>
<pre><code>?search=potatoes&amp;size[min]=3&amp;size[max]=7
</code></pre>
<p>Dot notation is more rare:</p>
<pre><code>?search=potatoes&amp;size.min=3&amp;size.max=7
</code></pre>
<p>Deeper nesting is not typically used. It would be very nontrivial to deserialize such URL parameters back into the object.</p>
<h2 id=summary>Summary</h2>
<p>The main ways of storing the local state are:</p>
<ul>
<li>no storage;</li>
<li>local storage;</li>
<li>URL parameters;</li>
<li>serialized blob.</li>
</ul>
<p>Memory and local storage are great for &ldquo;private&rdquo; state â€” settings, caches, history. URL parameters are good for the &ldquo;public&rdquo; state, so that one could bookmark or forward the stateful link. URLs with parameters are self-evident and allow one to pass rather complex data structures.</p>
<div class=row>
<div class="col-xs-12 col-sm-4">
<figure><img alt="String or number" src=state-scalar.png></figure>
</div>
<div class="col-xs-12 col-sm-4">
<figure><img alt="Boolean value" src=state-bool.png></figure>
</div>
<div class="col-xs-12 col-sm-4">
<figure><img alt="Date and time" src=state-date.png></figure>
</div>
</div>
<div class=row>
<div class="col-xs-12 col-sm-4">
<figure><img alt="Empty value" src=state-empty.png></figure>
</div>
<div class="col-xs-12 col-sm-4">
<figure><img alt="List (array)" src=state-list.png></figure>
</div>
<div class="col-xs-12 col-sm-4">
<figure><img alt="Dictionary (map)" src=state-dict.png></figure>
</div>
</div>
<p>Most importantly, whichever approach you choose â€” make sure to save and restore the context transparently for the user.</p>
<p><em>Follow <a href=https://twitter.com/ohmypy><strong>@ohmypy</strong></a> on Twitter to keep up with new posts</em>Â ðŸš€</p>
</div>
</div><footer class=post__footer>
<div class=row>
<div class=col-xs-12>
<div class=post__date>
<time datetime="2022-05-08 11:30:00 +0000 UTC">08 May, 2022</time>
</div>
<div class=post__tags>
<a href=https://antonz.org/tags/software/>software</a>&nbsp;
</div>
</div>
</div>
</footer></article>
<aside class=post__related>
<div class="post__nav article">
<div class=row>
<div class="col-xs-12 col-sm-6">
<p>&larr;&nbsp;<a href=https://antonz.org/generated-columns/>Generated columns in SQLite</a></p>
</div>
<div class="col-xs-12 col-sm-6">
<p><a href=https://antonz.org/python-stdlib-changes/>Python Standard Library changes in recent years</a>&nbsp;&rarr;</p>
</div>
</div>
</div>
<div class=article>
<div class=row>
<div class="col-xs-12 col-sm-8 col-md-6">
<h3>See also</h3>
<p><a href=/good-code/>Good Code Criterion</a></p>
</div>
</div>
</div>
</aside>
</div>
</div>
<footer class="container footer">
<ul class=naked-list>
<li class=footer__item>Subscribe:
<a href=https://twitter.com/ohmypy class=footer__social-link><i class="fab fa-twitter"></i><span>Twitter</span></a>
<a href=/index.xml class=footer__social-link><i class="fas fa-rss"></i><span>RSS</span></a>
</li>
<li class=footer__item>Email: <a href=mailto:m@antonz.org>m@antonz.org</a></li>
</ul>
</footer>
<script async src=//gc.zgo.at/count.js data-goatcounter=https://antonzorg.goatcounter.com/count></script></body>
</html>